/*!
 * dtValidator v1.1.8
 *
 * includes: jquery, bootstrap, fontawesome
 * Copyright 2014, http://www.dtvalidator.com, http://www.dlshouwen.com
 */

//初始化参数
!function($){$.fn.dtValidator=function(option){var validator={option:null,form:null,init:function(){var a=this;$(a.form).find(":input").each(function(){var c,d;return $(this).is(":file")||$(this).is(":button")||$(this).is(":submit")||$(this).is(":hidden")||void 0==$(this).attr("valid")?!0:($(this).removeAttr("validResult"),c=$(this).attr("validTitle"),d="",d=$(this).is(":radio")||$(this).is(":checkbox")||$(this).is("select")?$.fn.DtValidator.tools.replaceAll($.fn.dtValidator.lang.init.select,"{validTitle}",c):$.fn.DtValidator.tools.replaceAll($.fn.dtValidator.lang.init.input,"{validTitle}",c),a.validSingleHandler(this,"init",d),$(this).is(":radio")||$(this).is(":checkbox")?$(this).bind("click",function(){a.singleValid(this)}):$(this).bind("blur",function(){a.singleValid(this)}),void 0)}),$(a.form).find(":reset").bind("click",function(){a.reset()})},singleValid:function(element){var message,length,i,expression,minLengthExpression,maxLengthExpression,minLengthE,maxLengthE,minLength,maxLength,validPassword,j,key,result,minExpression,maxExpression,minE,maxE,min,max,validUnique,sqlCode,url,validParams,attrs,params,validatorReflectionObj=this,valid=$(element).attr("valid"),expressions=valid.split("|"),value=$(element).val(),name=$(element).attr("name"),validTitle=$(element).attr("validTitle");if(valid.length<=0)return message=$.fn.DtValidator.tools.replaceAll($.fn.dtValidator.lang.validate.success,"{validTitle}",validTitle),validatorReflectionObj.validSingleHandler(element,"success",message),void 0;if($(element).is(":radio")||$(element).is("select")&&"multiple"!=$(element).attr("multiple")){for(length=0,length=$(element).is(":radio")?$(validatorReflectionObj.form).find("input[name="+name+"]:checked").length:$.fn.DtValidator.tools.length(value),i=0;i<expressions.length;i++)if(expression=expressions[i],"r"==expression){if(0>=length)return message=$.fn.DtValidator.tools.replaceAll($.fn.dtValidator.lang.validate.required.select,"{validTitle}",validTitle),validatorReflectionObj.validSingleHandler(element,"failure",message),void 0;break}return message=$.fn.DtValidator.tools.replaceAll($.fn.dtValidator.lang.validate.success,"{validTitle}",validTitle),validatorReflectionObj.validSingleHandler(element,"success",message),void 0}if($(element).is(":checkbox")||$(element).is("select")&&"multiple"==$(element).attr("multiple")){if(length=0,length=$(element).is(":checkbox")?$(validatorReflectionObj.form).find("input[name="+name+"]:checked").length:$(validatorReflectionObj.form).find("select[name="+name+"] option:selected").length,valid.length<=0)return message=$.fn.DtValidator.tools.replaceAll($.fn.dtValidator.lang.validate.success,"{validTitle}",validTitle),validatorReflectionObj.validSingleHandler(element,"success",message),void 0;for(i=0;i<expressions.length;i++){if(expression=expressions[i],"r"==expression&&0>=length)return message=$.fn.DtValidator.tools.replaceAll($.fn.dtValidator.lang.validate.required.select,"{validTitle}",validTitle),validatorReflectionObj.validSingleHandler(element,"failure",message),void 0;if(expression.match(/^le?[0-9]*\-le?[0-9]*$/)){if(minLengthExpression=expression.split("-")[0],maxLengthExpression=expression.split("-")[1],minLengthE=-1!=minLengthExpression.indexOf("le")?">=":">",maxLengthE=-1!=maxLengthExpression.indexOf("le")?"<=":"<",minLength=minLengthExpression.match(/[0-9]+$/i),maxLength=maxLengthExpression.match(/[0-9]+$/i),null!=minLength&&eval("!("+length+minLengthE+minLength+")"))return message=-1!=minLengthExpression.indexOf("le")?$.fn.dtValidator.lang.validate.greatLess.multiple.greatEqualsThan:$.fn.dtValidator.lang.validate.greatLess.multiple.greatThan,message=$.fn.DtValidator.tools.replaceAll(message,"{validTitle}",validTitle),message=$.fn.DtValidator.tools.replaceAll(message,"{minLength}",minLength),validatorReflectionObj.validSingleHandler(element,"failure",message),void 0;if(null!=maxLength&&eval("!("+length+maxLengthE+maxLength+")"))return message=-1!=minLengthExpression.indexOf("le")?$.fn.dtValidator.lang.validate.greatLess.multiple.lessEqualsThan:$.fn.dtValidator.lang.validate.greatLess.multiple.lessThan,message=$.fn.DtValidator.tools.replaceAll(message,"{validTitle}",validTitle),message=$.fn.DtValidator.tools.replaceAll(message,"{maxLength}",maxLength),validatorReflectionObj.validSingleHandler(element,"failure",message),void 0;break}}return message=$.fn.DtValidator.tools.replaceAll($.fn.dtValidator.lang.validate.success,"{validTitle}",validTitle),validatorReflectionObj.validSingleHandler(element,"success",message),void 0}if(validPassword=$(element).attr("validPassword"),validPassword&&value!=$("input[name="+validPassword+"]").val())return message=$.fn.DtValidator.tools.replaceAll($.fn.dtValidator.lang.validate.passwordNotEquals,"{validTitle}",validTitle),validatorReflectionObj.validSingleHandler(element,"failure",message),void 0;for(length=$.fn.DtValidator.tools.length(value),j=0;j<expressions.length;j++)if(expression=expressions[j],"r"!=expression){if(null!=value&&""!=value){if(expression.match(/^le?[0-9]*\-le?[0-9]*$/)){if(minLengthExpression=expression.split("-")[0],maxLengthExpression=expression.split("-")[1],minLengthE=-1!=minLengthExpression.indexOf("le")?">=":">",maxLengthE=-1!=maxLengthExpression.indexOf("le")?"<=":"<",minLength=minLengthExpression.match(/[0-9]+$/i),maxLength=maxLengthExpression.match(/[0-9]+$/i),null!=minLength&&eval("!("+length+minLengthE+minLength+")"))return message=-1!=minLengthExpression.indexOf("le")?$.fn.dtValidator.lang.validate.greatLess.string.greatEqualsThan:$.fn.dtValidator.lang.validate.greatLess.string.greatThan,message=$.fn.DtValidator.tools.replaceAll(message,"{validTitle}",validTitle),message=$.fn.DtValidator.tools.replaceAll(message,"{minLength}",minLength),validatorReflectionObj.validSingleHandler(element,"failure",message),void 0;if(null!=maxLength&&eval("!("+length+maxLengthE+maxLength+")"))return message=-1!=minLengthExpression.indexOf("le")?$.fn.dtValidator.lang.validate.greatLess.string.lessEqualsThan:$.fn.dtValidator.lang.validate.greatLess.string.lessThan,message=$.fn.DtValidator.tools.replaceAll(message,"{validTitle}",validTitle),message=$.fn.DtValidator.tools.replaceAll(message,"{maxLength}",maxLength),validatorReflectionObj.validSingleHandler(element,"failure",message),void 0;continue}for(key in validatorReflectionObj.option.validType)if(expression==key)if("function"==typeof validatorReflectionObj.option.validType[key]){if(result=validatorReflectionObj.option.validType[key](value),!result.validResult)return message=result.validMessage,message=$.fn.DtValidator.tools.replaceAll(message,"{validTitle}",validTitle),message=$.fn.DtValidator.tools.replaceAll(message,"{typeName}",$.fn.dtValidator.lang.validTypeName[key]),validatorReflectionObj.validSingleHandler(element,"failure",message),void 0}else if(!value.match(validatorReflectionObj.option.validType[key]))return message=$.fn.dtValidator.lang.validate.typeFormat,message=$.fn.DtValidator.tools.replaceAll(message,"{validTitle}",validTitle),message=$.fn.DtValidator.tools.replaceAll(message,"{typeName}",$.fn.dtValidator.lang.validTypeName[key]),validatorReflectionObj.validSingleHandler(element,"failure",message),void 0;if(expression.match(/^me?[0-9]*\-me?[0-9]*$/)){if(minExpression=expression.split("-")[0],maxExpression=expression.split("-")[1],minE=-1!=minExpression.indexOf("me")?">=":">",maxE=-1!=maxExpression.indexOf("me")?"<=":"<",min=minExpression.match(/[0-9]+$/i),max=maxExpression.match(/[0-9]+$/i),null!=min&&eval("!(value"+minE+min+")"))return message=-1!=minExpression.indexOf("me")?$.fn.dtValidator.lang.validate.greatLess.number.greatEqualsThan:$.fn.dtValidator.lang.validate.greatLess.number.greatThan,message=$.fn.DtValidator.tools.replaceAll(message,"{validTitle}",validTitle),message=$.fn.DtValidator.tools.replaceAll(message,"{min}",min),validatorReflectionObj.validSingleHandler(element,"failure",message),void 0;if(null!=max&&eval("!(value"+maxE+max+")"))return message=-1!=minExpression.indexOf("me")?$.fn.dtValidator.lang.validate.greatLess.number.lessEqualsThan:$.fn.dtValidator.lang.validate.greatLess.number.lessThan,message=$.fn.DtValidator.tools.replaceAll(message,"{validTitle}",validTitle),message=$.fn.DtValidator.tools.replaceAll(message,"{max}",max),validatorReflectionObj.validSingleHandler(element,"failure",message),void 0;continue}}}else if(null==value||""==value.replace(/^\s+|\s+$/g,""))return message=$.fn.DtValidator.tools.replaceAll($.fn.dtValidator.lang.validate.required.input,"{validTitle}",validTitle),validatorReflectionObj.validSingleHandler(element,"failure",message),void 0;if(message=$.fn.DtValidator.tools.replaceAll($.fn.dtValidator.lang.validate.success,"{validTitle}",validTitle),validatorReflectionObj.validSingleHandler(element,"success",message),validUnique=$(element).attr("validUnique")){for(message=$.fn.DtValidator.tools.replaceAll($.fn.dtValidator.lang.unique.validating,"{validTitle}",validTitle),validatorReflectionObj.validSingleHandler(element,"validating",message),sqlCode=validUnique.split("|")[0],url=validatorReflectionObj.option.unique,validParams=new Object,validParams.sqlCode=sqlCode,validParams.key=$(element).val(),attrs=new Array,i=1;i<validUnique.split("|").length;i++)key=validUnique.split("|")[i],value=$("#"+key).val(),attrs.push(value);return validParams.attrs=attrs,params=new Object,params.validParams=JSON.stringify(validParams),$.ajax({type:"post",url:url,data:params,contentType:"application/x-www-form-urlencoded; charset=utf-8",beforeSend:function(a){a.setRequestHeader("__REQUEST_TYPE","AJAX_REQUEST")},success:function(a){var b;a=$.parseJSON(a),a?(b=$.fn.DtValidator.tools.replaceAll($.fn.dtValidator.lang.unique.success,"{validTitle}",validTitle),validatorReflectionObj.validSingleHandler(element,"unique_success",b)):(b=$.fn.DtValidator.tools.replaceAll($.fn.dtValidator.lang.unique.failure,"{validTitle}",validTitle),validatorReflectionObj.validSingleHandler(element,"unique_failure",b))},failure:function(){var d=$.fn.DtValidator.tools.replaceAll($.fn.dtValidator.lang.unique.error,"{validTitle}",validTitle);validatorReflectionObj.validSingleHandler(element,"unique_error",d)}}),void 0}},validSingleHandler:function(a,b,c){var f,g,h,i,j,k,l,m,d=this,e=$(a).attr("validInfoArea");e&&(f=e.split("|")[0],g=e.split("|")[1],h=e.split("|")[2],i=e.split("|")[3],j=e.split("|")[4],g||(g=d.option.css.area.init),h||(h=d.option.css.area.validating),i||(i=d.option.css.area.success),j||(j=d.option.css.area.failure),$("#"+f).removeClass(g),$("#"+f).removeClass(h),$("#"+f).removeClass(i),$("#"+f).removeClass(j),"init"==b?($("#"+f).addClass(g),$("#"+f).html(d.option.icon.init+c)):"validating"==b?($("#"+f).addClass(h),$("#"+f).html(d.option.icon.validating+c)):"success"==b||"unique_success"==b?($("#"+f).addClass(i),$("#"+f).html(d.option.icon.success+c)):("failure"==b||"unique_failure"==b||"unique_failure"==b)&&($("#"+f).addClass(j),$("#"+f).html(d.option.icon.failure+c))),k=$(a).attr("validElementCss"),k?(g=k.split("|")[0],h=k.split("|")[1],i=k.split("|")[2],j=k.split("|")[3],k=d.option.css.element,l=new Object,l.init=g,l.validating=h,l.success=i,l.failure=j,k=$.extend({},k,l)):k=d.option.css.element,"init"==b?d.option.elementCallback.init(a,k):"validating"==b?d.option.elementCallback.validating(a,k):"success"==b||"unique_success"==b?d.option.elementCallback.success(a,k):("failure"==b||"unique_failure"==b||"unique_failure"==b)&&d.option.elementCallback.failure(a,k),m=$(a).attr("name"),$(a).is(":checkbox")||$(a).is(":radio")?$("input[name="+m+"]").attr("validResult",b):$(a).attr("validResult",b)},valid:function(){var a=this;$(a.form).find(":input").each(function(){return $(this).is(":file")||$(this).is(":button")||$(this).is(":submit")||$(this).is(":hidden")||void 0==$(this).attr("valid")?!0:(a.singleValid(this),void 0)})},validResult:function(){var a=this,b=!0,c=!1;return $(a.form).find(":input").each(function(){if($(this).is(":file")||$(this).is(":button")||$(this).is(":submit")||$(this).is(":hidden")||void 0==$(this).attr("valid"))return!0;if($(this).attr("validResult")&&"init"!=$(this).attr("validResult")||a.singleValid(this),"validating"==$(this).attr("validResult")){var e=$(this).attr("validTitle");return $.fn.DtValidator.tools.toast($.fn.DtValidator.tools.replaceAll($.fn.dtValidator.lang.alert.validating,"{validTitle}",e),"info",3e3),b=!1,c=!0,!1}return"unique_failure"==$(this).attr("validResult")||"failure"==$(this).attr("validResult")?(b=!1,$(this).focus(),!1):void 0}),c||b||$.fn.DtValidator.tools.toast($.fn.dtValidator.lang.alert.error,"error",3e3),b},reset:function(){this.init()}};return validator.form=this,validator.option=$.extend(!0,{},$.fn.DtValidator.option,option),validator.init(),validator},$.fn.DtValidator={tools:{cardWi:[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2,1],cardValideCode:[1,0,10,9,8,7,6,5,4,3,2],cardIdValidate:function(a){if(15==a.length)return $.fn.DtValidator.tools.cardId15Validate(a);if(18==a.length)return $.fn.DtValidator.tools.cardId18Validate(a);var b=new Object;return b.validResult=!1,b.validMessage=$.fn.dtValidator.lang.validate.card.wrongLength,b},cardId15Validate:function(a){var b=new Object;return 15!=a.length?(b.validResult=!1,b.validMessage=$.fn.dtValidator.lang.validate.card.notCard15,b):$.fn.DtValidator.tools.isValidityBrithBy15IdCard(a)?(b.validResult=!0,b):(b.validResult=!1,b.validMessage=$.fn.dtValidator.lang.validate.card.wrongCard15,b)},cardId18Validate:function(a){var c,b=new Object;return 18!=a.length?(b.validResult=!1,b.validMessage=$.fn.dtValidator.lang.validate.card.notCard18,b):(c=a.split(""),$.fn.DtValidator.tools.isValidityBrithBy18IdCard(a)&&$.fn.DtValidator.tools.isTrueValidateCodeBy18IdCard(c)?(b.validResult=!0,b):(b.validResult=!1,b.validMessage=$.fn.dtValidator.lang.validate.card.wrongCard18,b))},isValidityBrithBy15IdCard:function(a){var b=a.substring(6,8),c=a.substring(8,10),d=a.substring(10,12),e=new Date(b,parseFloat(c)-1,parseFloat(d));return e.getYear()!=parseFloat(b)||e.getMonth()!=parseFloat(c)-1||e.getDate()!=parseFloat(d)?!1:!0},isTrueValidateCodeBy18IdCard:function(a){var c,b=0;for("x"==a[17].toLowerCase()&&(a[17]=10),c=0;17>c;c++)b+=$.fn.DtValidator.tools.cardWi[c]*a[c];return valCodePosition=b%11,a[17]==$.fn.DtValidator.tools.cardValideCode[valCodePosition]?!0:!1},isValidityBrithBy18IdCard:function(a){var b=a.substring(6,10),c=a.substring(10,12),d=a.substring(12,14),e=new Date(b,parseFloat(c)-1,parseFloat(d));return e.getFullYear()!=parseFloat(b)||e.getMonth()!=parseFloat(c)-1||e.getDate()!=parseFloat(d)?!1:!0},toastZIndex:1090,toastThread:null,toastFadeInAnimateTime:500,toastFadeOutAnimateTime:500,openToast:function(a,b,c){var d,e,f;b=b?b:"info",c=c?c:3e3,d="","info"==b&&(d="text-primary"),"warning"==b&&(d="text-warning"),"error"==b&&(d="text-danger"),"success"==b&&(d="text-success"),clearTimeout($.fn.DtValidator.tools.toastThread),$(".toast").remove(),e='<div class="toast '+d+'" style="z-index:'+$.fn.DtValidator.tools.toastZIndex+'">'+a+"</div>",$("body").append(e),f=$(window).width()/2-$(".toast").width()/2-20,$(".toast").css("left",f),$(".toast").fadeIn($.fn.DtValidator.tools.toastFadeInAnimateTime,function(){c&&($.fn.DtValidator.tools.toastThread=setTimeout($.fn.DtValidator.tools.removeToast,c))})},removeToast:function(){$(".toast").fadeOut($.fn.DtValidator.tools.toastFadeOutAnimateTime,function(){$(".toast").remove()})},toast:function(a,b,c){$.fn.DtValidator.tools.openToast(a,b,c)},replaceAll:function(a,b,c){return new String(a).replace(new RegExp(b,"gm"),c)},length:function(a){return new String(a).replace(/[^\x00-\xff]/g,"**").length}}}}(jQuery);

//初始化参数
(function($){
	$.fn.DtValidator.option = {
		//验证唯一的服务器地址
		unique : '/dtvalidator/unique',
		//验证类型
		validType : {
			email : /^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,
			phone : /^(\(?\+?[0-9]*\)?)?[0-9_\- \(\)]*$/,
			english_number : /^\w+$/,
			mobile : /^(0|86|17951)?(13[0-9]|15[012356789]|17[0678]|18[0-9]|14[57])[0-9]{8}$/,
			url : /^https?:\/\/(([a-zA-Z0-9_-])+(\.)?)*(:\d+)?(\/((\.)?(\?)?=?&?[a-zA-Z0-9_-](\?)?)*)*$/i,
			money : /^-?((\d{1,3}(,\d{3})*?)|\d+)(\.\d{1,2})?$/,
			number : /^\d+$/,
			zip : /^[1-9]\d{5}$/,
			qq : /^[1-9]\d{4,10}$/,
			integer : /^[-\+]?\d+$/,
			double : /^[-\+]?\d+(\.\d+)?$/,
			english : /^[A-Za-z]+$/,
			character : /^[A-Za-z0-9_-]+$/,
			chinese : /^[\u0391-\uFFE5]+$/,
			card : $.fn.DtValidator.tools.cardIdValidate,
			card15 : $.fn.DtValidator.tools.cardId15Validate,
			card18 : $.fn.DtValidator.tools.cardId18Validate
		},
		//默认样式
		css : {
			element : {
				init : '',
				validating : '',
				success : '',
				failure : 'has-error'
			},
			area : {
				init : '',
				validating : 'info-area-validating',
				success : 'info-area-success',
				failure : 'info-area-failure'
			}
		},
		//前缀图标
		icon : {
			init : '<i class="fa fa-exclamation-circle"></i>&nbsp;&nbsp;',
			validating: '<i class="fa fa-spinner fa-spin"></i>&nbsp;&nbsp;',
			success : '<i class="fa fa-check"></i>&nbsp;&nbsp;',
			failure : '<i class="fa fa-times"></i>&nbsp;&nbsp;'
		},
		//元素样式处理
		elementCallback : {
			init : function(element, css){
				
			},
			validating : function(element, css){
				
			},
			success : function(element, css){
				if($(element).is(':checkbox') || $(element).is(':radio')){
					var name = $(element).attr('name');
					$('input[name='+name+']').parents('.form-group').removeClass(css.failure);
				}else{
					$(element).parents('.form-group').removeClass(css.failure);
				}
			},
			failure : function(element, css){
				if($(element).is(':checkbox') || $(element).is(':radio')){
					var name = $(element).attr('name');
					$('input[name='+name+']').parents('.form-group').addClass(css.failure);
				}else{
					$(element).parents('.form-group').addClass(css.failure);
				}
			}
		}
	};
})(jQuery);